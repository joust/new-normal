<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <link rel="apple-touch-icon" href="images/nn-icon.png">
    <link rel="icon" type="image/png" href="images/nn-icon.png">
    <link rel="stylesheet" href="opensans.css">
    <link rel="stylesheet" href="crocodile.css">
    <title>New Normal - Corona-Uno</title>
    <script src="components/player-hand.js" type="text/javascript"></script>
    <script src="components/opponent-hand.js" type="text/javascript"></script>
    <script src="components/no-card.js" type="text/javascript"></script>
    <script src="components/card-pile.js" type="text/javascript"></script>
    <script src="components/argument-card.js" type="text/javascript"></script>
    <script src="components/game-card.js" type="text/javascript"></script>
    <script src="components/card-back.js" type="text/javascript"></script>
    <script src="components/label-card.js" type="text/javascript"></script>
    <script src="components/fallacy-card.js" type="text/javascript"></script>
    <script src="components/strawman-card.js" type="text/javascript"></script>
    <script src="components/appeal-to-card.js" type="text/javascript"></script>
    <script src="components/research-card.js" type="text/javascript"></script>
    <script src="components/discuss-card.js" type="text/javascript"></script>
    <script src="components/pause-card.js" type="text/javascript"></script>
    <script src="common.js" type="text/javascript"></script>
    <script src="fastclick.js" type="text/javascript"></script>
    <style>
      html, body, #uno {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow: visible;
      }
      
      html {
        overflow: hidden;
      }
        
      #uno {
        width: 100%;
        height: 100%;
      }
      #hand {
        margin-top: 3em;
        height: calc(100% - 4em);
        width: 100%;
      }

      @media (orientation: portrait) and (min-aspect-ratio: 1/2) {
        #hand {
          flex: 0.8;
        }
      }

      @media (orientation: landscape) and (min-aspect-ratio: 2/1) {
        #uno {
          display: flex;
          flex-direction: row;
          align-items: flex-end;
        }
        #hand {
          order: 1;
          height: 95%;
        }
        #deck {
          order: 2;
          height: 100%;
        }
      }

      #location {
        position: absolute;
        top: 0;
        right: 0;
        font-size: 2em;
        background: transparent;
        border: none;
      }
      
      #loader {
        position: absolute;
        border: 16px solid #f3f3f3;
        border-top: 16px solid #2d60f6; 
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
        z-index: 1;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .hidden {
        display: none;
      }
    </style>
    <script>
      function flagcheck() {
        if (navigator.userAgent.indexOf('Windows') > 0)
          document.head.innerHTML += '<link rel="stylesheet" href="noto.css">'
      }

      function fixAnchors(html) {
        return html.replaceAll('</h2></a>', '</h2>').replaceAll('</p>', '</p></a>')
      }

      async function loadContent(lang) {
        const loaded = document.querySelector(`#content > #${lang}`)
        if (!loaded) {
          const root = elementWithKids('div', [
            elementWithKids('div', null, { 'class': 'idiot' }),
            elementWithKids('div', null, { 'class': 'sheep' }),
            elementWithKids('div', null, { 'class': 'labels' }),
            elementWithKids('div', null, { 'class': 'appeal-tos' }),
            elementWithKids('div', null, { 'class': 'fallacies' }),
            elementWithKids('div', null, { 'class': 'topics' })
          ], { id: lang })
          document.querySelector('#content').appendChild(root)
          const [idiot, sheep, labels, appealTos, fallacies, topics] = await Promise.all([
            fetchSilent(`${lang}/idiot.html`),
            fetchSilent(`${lang}/sheep.html`),
            fetchSilent(`${lang}/labels.html`),
            fetchSilent(`${lang}/appeal-tos.html`),
            fetchSilent(`${lang}/fallacies.html`),
            fetchSilent(`${lang}/topics.html`)
          ])
          root.querySelector('.idiot').innerHTML =  fixAnchors(idiot)
          root.querySelector('.sheep').innerHTML = fixAnchors(sheep)
          root.querySelector('.labels').innerHTML = labels
          root.querySelector('.appeal-tos').innerHTML = appealTos
          root.querySelector('.fallacies').innerHTML = fallacies
          root.querySelector('.topics').innerHTML = topics
          
          return {idiot, sheep, labels, appealTos, fallacies, topics}
        }
      }
      
      function idsFrom(content, filter = '') {
        return [...content.matchAll(/a id="([^"]*)"/g)].map(r => r[1]).filter(id => id.includes(filter))
      }
      
      function setLang(loc) {
        document.body.lang = loc.split('-')[0] 
      }
      
      async function addHand() {
        const content = await loadContent(document.body.lang)
        const cards = JSON.stringify([
          {card: 'S1', alt: idsFrom(content.sheep), playable: true},
          {card: 'I2', alt: idsFrom(content.idiot), playable: true},
          {card: 'AS1', alt: idsFrom(content.appealTos, 'AS'), playable: true},
          {card: 'AI1', alt: idsFrom(content.appealTos, 'AI'), playable: true},
          {card: 'FS1', alt: idsFrom(content.fallacies, 'FS'), playable: true},
          {card: 'FI1', alt: idsFrom(content.fallacies, 'FI'), playable: true},
          {card: 'LS1', alt: idsFrom(content.labels, 'LS'), playable: true},
          {card: 'LI1', alt: idsFrom(content.labels, 'LI'), playable: true},
          {card: 'T1:DS', alt: idsFrom(content.topics).map(id => `${id}:DS`), playable: true},
          {card: 'T2:DI', alt: idsFrom(content.topics).map(id => `${id}:DI`), playable: true},
          {card: 'NI', alt: ['NI'], playable: true},
          {card: 'NS', alt: ['NS'], playable: true},
          {card: 'RS', alt: ['RS'], playable: true},
          {card: 'RI', alt: ['RI'], playable: true},
          {card: 'PS', alt: ['PS'], playable: true},
          {card: 'PI', alt: ['PI'], playable: true}
        ])
        const existing = document.querySelector('#hand')
        if (existing) existing.parentElement.removeChild(existing)
        
        document.querySelector('#uno').insertAdjacentHTML('beforeEnd', '<player-hand nr="0" name="All Cards" id="hand" cards="[]"></player-hand>')
        document.querySelector('#hand').setAttribute('cards', cards)
      }
    </script>
  </head>
  <body lang="de" onload="flagcheck(); addHand()">
    <div id="uno">
      <div id="game">
      </div>
    </div>
    <select id="location" onchange="setLang(event.target.value); addHand()">
      <option title="Deutschland" value="de-de">ğŸ‡©ğŸ‡ª</option>
      <option title="Ã–sterreich" value="de-at">ğŸ‡¦ğŸ‡¹</option>
      <option title="Schweiz" value="de-ch">ğŸ‡¨ğŸ‡­</option>
      <option title="Svizzera" value="it-ch">ğŸ‡¨ğŸ‡­</option>
      <option title="Suisse" value="fr-ch">ğŸ‡¨ğŸ‡­</option>
      <option title="Danmark" value="da-da">ğŸ‡©ğŸ‡°</option>
      <option title="Liechtenstein" value="de-li">ğŸ‡±ğŸ‡®</option>
      <option title="Italia" value="it-it">ğŸ‡®ğŸ‡¹</option>
      <option title="Italien" value="de-it">ğŸ‡®ğŸ‡¹</option>
      <option title="San Marino" value="it-sm">ğŸ‡¸ğŸ‡²</option>
      <option title="CittÃ  del Vaticano" value="it-va">ğŸ‡»ğŸ‡¦</option>
      <option title="United States" value="en-us">ğŸ‡ºğŸ‡¸</option>
      <option title="United Kingdom" value="en-gb">ğŸ‡¬ğŸ‡§</option>
      <option title="Australia" value="en-au">ğŸ‡¦ğŸ‡º</option>
      <option title="New Zealand" value="en-nz">ğŸ‡³ğŸ‡¿</option>
      <option title="Canada" value="en-ca">ğŸ‡¨ğŸ‡¦</option>
      <option title="Canada" value="fr-ca">ğŸ‡¨ğŸ‡¦</option>
      <option title="Polska" value="pl-pl">ğŸ‡µğŸ‡±</option>
      <option title="Antigua and Barbuda" value="en-ag">ğŸ‡¦ğŸ‡¬</option>
      <option title="The Bahamas" value="en-bs">ğŸ‡§ğŸ‡¸</option>
      <option title="Barbados" value="en-bb">ğŸ‡§ğŸ‡§</option>
      <option title="Belize" value="en-bz">ğŸ‡§ğŸ‡¿ </option>
      <option title="Dominica" value="en-dm">ğŸ‡©ğŸ‡²</option>
      <option title="Grenada" value="en-gd">ğŸ‡¬ğŸ‡©</option>
      <option title="Guyana" value="en-gy">ğŸ‡¬ğŸ‡¾</option>
      <option title="Ireland" value="en-ie">ğŸ‡®ğŸ‡ª</option>
      <option title="Jamaica" value="en-jm">ğŸ‡¯ğŸ‡²</option>
      <option title="Malta" value="en-mt">ğŸ‡²ğŸ‡¹</option>
      <option title="St Kitts and Nevis" value="en-kn">ğŸ‡°ğŸ‡³</option>
      <option title="St Lucia" value="en-lc">ğŸ‡±ğŸ‡¨</option>
      <option title="St Vincent and the Grenadines" value="en-vc">ğŸ‡»ğŸ‡¨</option>
      <option title="Trinidad and Tobago" value="en-tt">ğŸ‡¹ğŸ‡¹</option>
      <option title="EspaÃ±a" value="es-es">ğŸ‡ªğŸ‡¸</option>
      <option title="Cuba" value="es-cu">ğŸ‡¨ğŸ‡º</option>
      <option title="PerÃº" value="es-pe">ğŸ‡µğŸ‡ª</option>
      <option title="Chile" value="es-cl">ğŸ‡¨ğŸ‡±</option>
      <option title="MÃ©xico" value="es-mx">ğŸ‡²ğŸ‡½</option>
      <option title="Puerto Rico" value="es-pr">ğŸ‡µğŸ‡·</option>
      <option title="Argentina" value="es-ar">ğŸ‡¦ğŸ‡·</option>
      <option title="Bolivia" value="es-bo">ğŸ‡§ğŸ‡´</option>
      <option title="Colombia" value="es-co">ğŸ‡¨ğŸ‡´</option>
      <option title="Costa Rica" value="es-cr">ğŸ‡¨ğŸ‡·</option>
      <option title="RepÃºblica Dominicana" value="es-do">ğŸ‡©ğŸ‡´</option>
      <option title="Ecuador" value="es-ec">ğŸ‡ªğŸ‡¨</option>
      <option title="El Salvador" value="es-sv">ğŸ‡¸ğŸ‡»</option>
      <option title="Guinea Ecuatorial" value="es-gq">ğŸ‡¬ğŸ‡¶</option>
      <option title="Guatemala" value="es-gt">ğŸ‡¬ğŸ‡¹</option>
      <option title="Honduras" value="es-hn">ğŸ‡­ğŸ‡³</option>
      <option title="Nicaragua" value="es-ni">ğŸ‡³ğŸ‡®</option>
      <option title="Panama" value="es-pa">ğŸ‡µğŸ‡¦</option>
      <option title="Paraguay" value="es-py">ğŸ‡µğŸ‡¾</option>
      <option title="Uruguay" value="es-uy">ğŸ‡ºğŸ‡¾</option>
      <option title="Venezuela" value="es-ve">ğŸ‡»ğŸ‡ª</option>
      <option title="Portugual" value="pt-pt">ğŸ‡µğŸ‡¹</option>
      <option title="Brasil" value="pt-br">ğŸ‡§ğŸ‡·</option>
      <option title="Angola" value="pt-ao">ğŸ‡¦ğŸ‡´</option>
      <option title="MoÃ§ambique" value="pt-mz">ğŸ‡²ğŸ‡¿</option>
      <option title="GuinÃ©-Bissau" value="pt-gw">ğŸ‡¬ğŸ‡¼</option>
      <option title="SÃ£o TomÃ© &amp; PrÃ­ncipe" value="pt-st">ğŸ‡¸ğŸ‡¹</option>
      <option title="Cabo Verde" value="pt-cv">ğŸ‡¨ğŸ‡»</option>
      <option title="France" value="fr-fr">ğŸ‡«ğŸ‡·</option>
      <option title="BelgiÃ«" value="nl-be">ğŸ‡§ğŸ‡ª</option>
      <option title="Belgien" value="de-be">ğŸ‡§ğŸ‡ª</option>
      <option title="Belgique" value="fr-be">ğŸ‡§ğŸ‡ª</option>
      <option title="Congo" value="fr-cd">ğŸ‡¨ğŸ‡©</option>
      <option title="Congo" value="fr-cg">ğŸ‡¨ğŸ‡¬</option>
      <option title="CÃ´te dâ€™Ivoire" value="fr-ko">ğŸ‡¨ğŸ‡®</option>
      <option title="Madagascar" value="fr-ko">ğŸ‡²ğŸ‡¬</option>
      <option title="Cameroun" value="fr-cm">ğŸ‡¨ğŸ‡²</option>
      <option title="Cameroon" value="en-cm">ğŸ‡¨ğŸ‡²</option>
      <option title="Burkina Faso" value="fr-bf">ğŸ‡§ğŸ‡«</option>
      <option title="Niger" value="fr-ne">ğŸ‡³ğŸ‡ª</option>
      <option title="Mali" value="fr-ml">ğŸ‡²ğŸ‡±</option>
      <option title="SÃ©nÃ©gal" value="fr-sn">ğŸ‡¸ğŸ‡³</option>
      <option title="HaÃ¯ti" value="fr-ht">ğŸ‡­ğŸ‡¹</option>
      <option title="Benin" value="fr-bj">ğŸ‡§ğŸ‡¯</option>
    </select>
    <div id="content" class="hidden"></div>
    <div id="loader" class="hidden"></div>
  </body>
</html>
