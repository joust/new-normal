<!DOCTYPE html>
<html>
  <head>
  <title>New Normal - Corona-Uno</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="opensans.css">
  <link rel="stylesheet" href="crocodile.css">
  <link rel="stylesheet" href="components/cards.css">
  <script src="dialog.js" type="text/javascript"></script>
  <script src="components/argument-card.js" type="text/javascript"></script>
  <script src="components/test-card.js" type="text/javascript"></script>
  <script src="common.js" type="text/javascript"></script>
  <script src="fastclick.js" type="text/javascript"></script>
  <style>
    html, body, #uno {
      font-family: 'Open Sans', Helvetica;
      font-size: 3vmin;
      position: fixed;
      height: 100%;
      width: 100%;
      margin: 0;
      overflow: hidden;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hidden {
      display: none;
    }

    #test, test-card {
      width: 420px;
      height: 600px;
    }
  </style>
</head>
<body onload="flagcheck(); load()">
  <script>
    async function load(locale) {
      FastClick.attach(document.body)
      if (locale) [lang, terr] = locale.split('-'); else [lang, terr] = browserLocale()
      if (!supported.includes(lang)) [lang, terr] = ['en', 'us']
      document.body.lang = lang
      await loadContent(lang)
      document.getElementById('test').insertAdjacentHTML('afterBegin', '<test-card card="T1:I1"></test-card>')
    }

    function flagcheck() {
      if (navigator.userAgent.indexOf('Windows') > 0)
        document.head.innerHTML += '<link rel="stylesheet" href="noto.css">'
    }

    async function loadContent(lang) {
      const loaded = document.querySelector(`#content > #${lang}`)
      if (!loaded) {
        const root = elementWithKids('div', [
          elementWithKids('div', null, { 'class': 'idiot' }),
          elementWithKids('div', null, { 'class': 'sheep' }),
          elementWithKids('div', null, { 'class': 'topics' })
        ], { id: lang })
        document.querySelector('#content').appendChild(root)
        const [idiot, sheep, topics] = await Promise.all([
          fetchSilent(`${lang}/idiot.html`),
          fetchSilent(`${lang}/sheep.html`),
          fetchSilent(`${lang}/topics.html`)
        ])
        root.querySelector('.idiot').innerHTML =  idiot
        root.querySelector('.sheep').innerHTML = sheep
        root.querySelector('.topics').innerHTML = topics
      }
    }
  </script>
  <div id="test">
  </div>
  <div id="content" class="hidden">
  </div>
  <div id="loader" class="hidden"></div>
</body>
</html>
